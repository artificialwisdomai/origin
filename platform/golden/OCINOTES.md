# Notes for building and pushing to OCI directly from VirtualBox

## manual mode

Install the oci command line client

OSX

```bash
brew install oci-cli
```

Linux

```bash
python3 -m pip install oci-cli
```

Windows

```bash
choclatey install oci-cli
```

Configure with an OCI generated API key (gotta get that from the console: Profile->API keys). Don't forget the public key fingerprint as well.

Download the .pem file that is generated (don't forget to do this, or you'll just need to create a new key). Store it in the ~/.oci directory (create if it doesn't exist).

Also, you need your tenancy, user, and compartment OCIDs. You add them to:

```bash
cat >> ~/.oci/config <<EOF
[DEFAULT]
user=<USER_OCID>
tenancy=<TENANT_OCID>
region=us-phoenix-1
key_file=~/.oci/<API_AUTH_PRIVATE_KEY>.pem
fingerprint=<API_AUTH_PUB_FINGERPRINT>
EOF

cat >> ~/.oci/oci_cli_rc <<EOF
[DEFAULT]
compartment-id=<COMPARTMENT_ID>
EOF
```

Run upload-image.sh script

```bash
bash upload-image.sh
```

###

Ubuntu 22.04 OCI data

/boot/efi/EFI/ubuntu/grub.cfg

```txt
search.fs_uuid 515452ae-011a-4bca-ae75-690f434507be root
set prefix=($root)'/boot/grub'
configfile $prefix/grub.cfg
```

/boot/grub/grub.cfg # Generated

```txt
#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###
if [ -s $prefix/grubenv ]; then
  set have_grubenv=true
  load_env
fi
if [ "${initrdfail}" = 2 ]; then
   set initrdfail=
elif [ "${initrdfail}" = 1 ]; then
   set next_entry="${prev_entry}"
   set prev_entry=
   save_env prev_entry
   if [ "${next_entry}" ]; then
      set initrdfail=2
   fi
fi
if [ "${next_entry}" ] ; then
   set default="${next_entry}"
   set next_entry=
   save_env next_entry
   set boot_once=true
else
   set default="0"
fi

if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"
else
  menuentry_id_option=""
fi

export menuentry_id_option

if [ "${prev_saved_entry}" ]; then
  set saved_entry="${prev_saved_entry}"
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=true
fi

function savedefault {
  if [ -z "${boot_once}" ]; then
    saved_entry="${chosen}"
    save_env saved_entry
  fi
}
function initrdfail {
    if [ -n "${have_grubenv}" ]; then if [ -n "${partuuid}" ]; then
      if [ -z "${initrdfail}" ]; then
        set initrdfail=1
        if [ -n "${boot_once}" ]; then
          set prev_entry="${default}"
          save_env prev_entry
        fi
      fi
      save_env initrdfail
    fi; fi
}
function recordfail {
  set recordfail=1
  if [ -n "${have_grubenv}" ]; then if [ -z "${boot_once}" ]; then save_env recordfail; fi; fi
}
function load_video {
  if [ x$feature_all_video_module = xy ]; then
    insmod all_video
  else
    insmod efi_gop
    insmod efi_uga
    insmod ieee1275_fb
    insmod vbe
    insmod vga
    insmod video_bochs
    insmod video_cirrus
  fi
}

terminal_input console
terminal_output console
if [ "${recordfail}" = 1 ] ; then
  set timeout=0
else
  if [ x$feature_timeout_style = xy ] ; then
    set timeout_style=hidden
    set timeout=0
  # Fallback hidden-timeout code in case the timeout_style feature is
  # unavailable.
  elif sleep --interruptible 0 ; then
    set timeout=0
  fi
fi
### END /etc/grub.d/00_header ###

### BEGIN /etc/grub.d/01_track_initrdless_boot_fallback ###
if [ -n "${have_grubenv}" ]; then
  if [ -n "${initrdfail}" ]; then
    set initrdless_boot_fallback_triggered="${initrdfail}"
  else
    unset initrdless_boot_fallback_triggered
  fi
  save_env initrdless_boot_fallback_triggered
fi
### END /etc/grub.d/01_track_initrdless_boot_fallback ###

### BEGIN /etc/grub.d/05_debian_theme ###
set menu_color_normal=white/black
set menu_color_highlight=black/light-gray
### END /etc/grub.d/05_debian_theme ###

### BEGIN /etc/grub.d/10_linux ###
function gfxmode {
	set gfxpayload="${1}"
	if [ "${1}" = "keep" ]; then
		set vt_handoff=vt.handoff=7
	else
		set vt_handoff=
	fi
}
if [ "${recordfail}" != 1 ]; then
  if [ -e ${prefix}/gfxblacklist.txt ]; then
    if [ ${grub_platform} != pc ]; then
      set linux_gfx_mode=keep
    elif hwmatch ${prefix}/gfxblacklist.txt 3; then
      if [ ${match} = 0 ]; then
        set linux_gfx_mode=keep
      else
        set linux_gfx_mode=text
      fi
    else
      set linux_gfx_mode=text
    fi
  else
    set linux_gfx_mode=keep
  fi
else
  set linux_gfx_mode=text
fi
export linux_gfx_mode
menuentry 'Ubuntu' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-simple-515452ae-011a-4bca-ae75-690f434507be' {
	recordfail
	load_video
	gfxmode $linux_gfx_mode
	insmod gzio
	if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi
	insmod part_gpt
	insmod ext2
	search --no-floppy --fs-uuid --set=root 515452ae-011a-4bca-ae75-690f434507be
	linux	/boot/vmlinuz-5.15.0-1033-oracle root=LABEL=cloudimg-rootfs ro  console=tty1 console=ttyS0 nvme.shutdown_timeout=10 libiscsi.debug_libiscsi_eh=1 crash_kexec_post_notifiers
	initrd	/boot/initrd.img-5.15.0-1033-oracle
}
submenu 'Advanced options for Ubuntu' $menuentry_id_option 'gnulinux-advanced-515452ae-011a-4bca-ae75-690f434507be' {
	menuentry 'Ubuntu, with Linux 5.15.0-1033-oracle' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.15.0-1033-oracle-advanced-515452ae-011a-4bca-ae75-690f434507be' {
		recordfail
		load_video
		gfxmode $linux_gfx_mode
		insmod gzio
		if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi
		insmod part_gpt
		insmod ext2
		search --no-floppy --fs-uuid --set=root 515452ae-011a-4bca-ae75-690f434507be
		echo	'Loading Linux 5.15.0-1033-oracle ...'
		linux	/boot/vmlinuz-5.15.0-1033-oracle root=LABEL=cloudimg-rootfs ro  console=tty1 console=ttyS0 nvme.shutdown_timeout=10 libiscsi.debug_libiscsi_eh=1 crash_kexec_post_notifiers
		echo	'Loading initial ramdisk ...'
		initrd	/boot/initrd.img-5.15.0-1033-oracle
	}
	menuentry 'Ubuntu, with Linux 5.15.0-1033-oracle (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.15.0-1033-oracle-recovery-515452ae-011a-4bca-ae75-690f434507be' {
		recordfail
		load_video
		insmod gzio
		if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi
		insmod part_gpt
		insmod ext2
		search --no-floppy --fs-uuid --set=root 515452ae-011a-4bca-ae75-690f434507be
		echo	'Loading Linux 5.15.0-1033-oracle ...'
		linux	/boot/vmlinuz-5.15.0-1033-oracle root=LABEL=cloudimg-rootfs ro recovery nomodeset dis_ucode_ldr
		echo	'Loading initial ramdisk ...'
		initrd	/boot/initrd.img-5.15.0-1033-oracle
	}
}

### END /etc/grub.d/10_linux ###

### BEGIN /etc/grub.d/10_linux_zfs ###
### END /etc/grub.d/10_linux_zfs ###

### BEGIN /etc/grub.d/20_linux_xen ###

### END /etc/grub.d/20_linux_xen ###

### BEGIN /etc/grub.d/30_os-prober ###
### END /etc/grub.d/30_os-prober ###

### BEGIN /etc/grub.d/30_uefi-firmware ###
### END /etc/grub.d/30_uefi-firmware ###

### BEGIN /etc/grub.d/40_custom ###
# This file provides an easy way to add custom menu entries.  Simply type the
# menu entries you want to add after this comment.  Be careful not to change
# the 'exec tail' line above.
### END /etc/grub.d/40_custom ###

### BEGIN /etc/grub.d/41_custom ###
if [ -f  ${config_directory}/custom.cfg ]; then
  source ${config_directory}/custom.cfg
elif [ -z "${config_directory}" -a -f  $prefix/custom.cfg ]; then
  source $prefix/custom.cfg
fi
### END /etc/grub.d/41_custom ###
```

lsmod output

```txt
Module                  Size  Used by
binfmt_misc            24576  1
sunrpc                585728  1
nft_counter            16384  23
xt_comment             16384  15
xt_owner               16384  5
ipt_REJECT             16384  4
nf_reject_ipv4         16384  1 ipt_REJECT
xt_tcpudp              20480  17
xt_state               16384  0
xt_conntrack           16384  2
nf_conntrack          172032  2 xt_conntrack,xt_state
nf_defrag_ipv6         24576  1 nf_conntrack
nf_defrag_ipv4         16384  1 nf_conntrack
nft_compat             20480  43
nf_tables             249856  91 nft_compat,nft_counter
nfnetlink              20480  2 nft_compat,nf_tables
nls_iso8859_1          16384  1
intel_rapl_msr         20480  0
intel_rapl_common      40960  1 intel_rapl_msr
i10nm_edac             20480  0
nfit                   81920  1 i10nm_edac
x86_pkg_temp_thermal    20480  0
intel_powerclamp       20480  0
coretemp               24576  0
kvm_intel             368640  0
kvm                  1028096  1 kvm_intel
rapl                   20480  0
intel_cstate           20480  0
joydev                 32768  0
input_leds             16384  0
isst_if_mbox_pci       16384  0
mei_me                 40960  0
isst_if_mmio           16384  0
ioatdma                73728  0
isst_if_common         24576  2 isst_if_mmio,isst_if_mbox_pci
mei                   135168  1 mei_me
intel_pch_thermal      20480  0
dca                    16384  1 ioatdma
mac_hid                16384  0
sch_fq_codel           20480  1
dm_multipath           40960  0
scsi_dh_rdac           20480  0
scsi_dh_emc            16384  0
scsi_dh_alua           20480  0
msr                    16384  0
ramoops                32768  0
reed_solomon           28672  1 ramoops
pstore_blk             16384  0
pstore_zone            32768  1 pstore_blk
efi_pstore             16384  0
ip_tables              32768  0
x_tables               53248  8 xt_conntrack,nft_compat,xt_state,xt_tcpudp,xt_comment,xt_owner,ipt_REJECT,ip_tables
autofs4                49152  2
btrfs                1560576  0
blake2b_generic        20480  0
zstd_compress         229376  1 btrfs
iscsi_tcp              24576  3
libiscsi_tcp           32768  1 iscsi_tcp
libiscsi               69632  2 libiscsi_tcp,iscsi_tcp
scsi_transport_iscsi   139264  4 libiscsi_tcp,iscsi_tcp,libiscsi
iscsi_ibft             16384  0
iscsi_boot_sysfs       20480  1 iscsi_ibft
raid10                 69632  0
raid456               163840  0
async_raid6_recov      24576  1 raid456
async_memcpy           20480  2 raid456,async_raid6_recov
async_pq               24576  2 raid456,async_raid6_recov
async_xor              20480  3 async_pq,raid456,async_raid6_recov
async_tx               20480  5 async_pq,async_memcpy,async_xor,raid456,async_raid6_recov
xor                    24576  2 async_xor,btrfs
raid6_pq              122880  4 async_pq,btrfs,raid456,async_raid6_recov
libcrc32c              16384  4 nf_conntrack,btrfs,nf_tables,raid456
raid1                  49152  0
raid0                  24576  0
multipath              20480  0
linear                 20480  0
mlx5_ib               393216  0
ib_uverbs             163840  1 mlx5_ib
ib_core               393216  2 ib_uverbs,mlx5_ib
hid_generic            16384  0
usbhid                 65536  0
hid                   151552  2 usbhid,hid_generic
mgag200                40960  0
i2c_algo_bit           16384  1 mgag200
drm_kms_helper        315392  3 mgag200
syscopyarea            16384  1 drm_kms_helper
crct10dif_pclmul       16384  1
sysfillrect            20480  1 drm_kms_helper
crc32_pclmul           16384  0
mlx5_core            1593344  1 mlx5_ib
sysimgblt              16384  1 drm_kms_helper
ghash_clmulni_intel    16384  0
fb_sys_fops            16384  1 drm_kms_helper
cec                    61440  1 drm_kms_helper
aesni_intel           376832  0
rc_core                65536  1 cec
mlxfw                  32768  1 mlx5_core
psample                20480  1 mlx5_core
crypto_simd            16384  1 aesni_intel
tls                   114688  1 mlx5_core
drm                   622592  3 drm_kms_helper,mgag200
cryptd                 24576  2 crypto_simd,ghash_clmulni_intel
i2c_i801               36864  0
xhci_pci               24576  0
pci_hyperv_intf        16384  1 mlx5_core
i2c_smbus              20480  1 i2c_i801
xhci_pci_renesas       20480  1 xhci_pci
intel_pmt              16384  0
wmi                    32768  0
```


disk partition table/model

```txt
Device      Start       End   Sectors  Size Type
/dev/sda1  227328 134217694 133990367 63.9G Linux filesystem
/dev/sda14   2048     10239      8192    4M BIOS boot
/dev/sda15  10240    227327    217088  106M EFI System
```

network config

```txt
ubuntu@proto-a10:/etc/grub.d$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: ens300f0np0: <BROADCAST,UP,LOWER_UP> mtu 9000 qdisc mq state UP group default qlen 1000
    link/ether 08:c0:eb:ac:22:68 brd ff:ff:ff:ff:ff:ff
    altname enp75s0f0np0
    inet 10.0.0.49/24 metric 100 brd 10.0.0.255 scope global ens300f0np0
       valid_lft forever preferred_lft forever
    inet6 fe80::ac0:ebff:feac:2268/64 scope link
       valid_lft forever preferred_lft forever
3: ens300f1np1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 08:c0:eb:ac:22:69 brd ff:ff:ff:ff:ff:ff
    altname enp75s0f1np1
    inet6 fe80::ac0:ebff:feac:2269/64 scope link
       valid_lft forever preferred_lft forever
```

